(function() {
  var plugin, qs, spawn;

  qs = require('querystring');

  spawn = require('child_process').spawn;

  plugin = module.exports = {
    configDefaults: {
      grammars: require('./map')
    },
    activate: function() {
      atom.workspaceView.command('dash:shortcut', this.shortcut);
      atom.workspaceView.command('dash:shortcut-alt', this.shortcut.bind(this, false));
      return atom.workspaceView.command('dash:context-menu', this.contextMenu);
    },
    shortcut: function(sensitive) {
      var currentScope, editor, range, scopes, selection, text;
      editor = atom.workspace.getActiveEditor();
      selection = editor.getSelection().getText();
      if (selection) {
        return plugin.search(selection, sensitive);
      }
      scopes = editor.getCursorScopes();
      currentScope = scopes[scopes.length - 1];
      if (scopes.length > 1 && !/^(?:comment|string|meta|markup)(?:\.|$)/.test(currentScope)) {
        range = editor.bufferRangeForScopeAtCursor(currentScope);
        text = editor.getTextInBufferRange(range);
      } else {
        text = editor.getWordUnderCursor();
      }
      return plugin.search(text, sensitive);
    },
    contextMenu: function() {
      return plugin.search(atom.workspace.getActiveEditor().getWordUnderCursor(), true);
    },
    search: function(string, sensitive) {
      var language;
      if (sensitive) {
        language = atom.workspace.getActiveEditor().getGrammar().name;
      }
      return spawn('open', [this.createLink(string, language)]);
    },
    createLink: function(string, language) {
      var keys, link;
      if (language) {
        keys = atom.config.get('dash.grammars.' + language);
      }
      link = 'dash-plugin://';
      if (keys != null ? keys.length : void 0) {
        link += 'keys=' + keys.map(encodeURIComponent).join(',') + '&';
      }
      return link + 'query=' + encodeURIComponent(string);
    }
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAiZmlsZSI6ICIiLAogICJzb3VyY2VSb290IjogIiIsCiAgInNvdXJjZXMiOiBbCiAgICAiIgogIF0sCiAgIm5hbWVzIjogW10sCiAgIm1hcHBpbmdzIjogIkFBQUE7QUFBQSxNQUFBLGlCQUFBOztBQUFBLEVBQUEsRUFBQSxHQUFRLE9BQUEsQ0FBUSxhQUFSLENBQVIsQ0FBQTs7QUFBQSxFQUNBLEtBQUEsR0FBUSxPQUFBLENBQVEsZUFBUixDQUF3QixDQUFDLEtBRGpDLENBQUE7O0FBQUEsRUFHQSxNQUFBLEdBQVMsTUFBTSxDQUFDLE9BQVAsR0FDUDtBQUFBLElBQUEsY0FBQSxFQUNFO0FBQUEsTUFBQSxRQUFBLEVBQVUsT0FBQSxDQUFRLE9BQVIsQ0FBVjtLQURGO0FBQUEsSUFHQSxRQUFBLEVBQVUsU0FBQSxHQUFBO0FBQ1IsTUFBQSxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQW5CLENBQTJCLGVBQTNCLEVBQTRDLElBQUMsQ0FBQSxRQUE3QyxDQUFBLENBQUE7QUFBQSxNQUNBLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBbkIsQ0FBMkIsbUJBQTNCLEVBQWdELElBQUMsQ0FBQSxRQUFRLENBQUMsSUFBVixDQUFlLElBQWYsRUFBa0IsS0FBbEIsQ0FBaEQsQ0FEQSxDQUFBO2FBRUEsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFuQixDQUEyQixtQkFBM0IsRUFBZ0QsSUFBQyxDQUFBLFdBQWpELEVBSFE7SUFBQSxDQUhWO0FBQUEsSUFRQSxRQUFBLEVBQVUsU0FBQyxTQUFELEdBQUE7QUFDUixVQUFBLG9EQUFBO0FBQUEsTUFBQSxNQUFBLEdBQVksSUFBSSxDQUFDLFNBQVMsQ0FBQyxlQUFmLENBQUEsQ0FBWixDQUFBO0FBQUEsTUFDQSxTQUFBLEdBQVksTUFBTSxDQUFDLFlBQVAsQ0FBQSxDQUFxQixDQUFDLE9BQXRCLENBQUEsQ0FEWixDQUFBO0FBR0EsTUFBQSxJQUE4QyxTQUE5QztBQUFBLGVBQU8sTUFBTSxDQUFDLE1BQVAsQ0FBYyxTQUFkLEVBQXlCLFNBQXpCLENBQVAsQ0FBQTtPQUhBO0FBQUEsTUFLQSxNQUFBLEdBQWUsTUFBTSxDQUFDLGVBQVAsQ0FBQSxDQUxmLENBQUE7QUFBQSxNQU1BLFlBQUEsR0FBZSxNQUFPLENBQUEsTUFBTSxDQUFDLE1BQVAsR0FBZ0IsQ0FBaEIsQ0FOdEIsQ0FBQTtBQVdBLE1BQUEsSUFBRyxNQUFNLENBQUMsTUFBUCxHQUFnQixDQUFoQixJQUFxQixDQUFBLHlDQUEwQyxDQUFDLElBQTFDLENBQStDLFlBQS9DLENBQXpCO0FBQ0UsUUFBQSxLQUFBLEdBQVEsTUFBTSxDQUFDLDJCQUFQLENBQW1DLFlBQW5DLENBQVIsQ0FBQTtBQUFBLFFBQ0EsSUFBQSxHQUFRLE1BQU0sQ0FBQyxvQkFBUCxDQUE0QixLQUE1QixDQURSLENBREY7T0FBQSxNQUFBO0FBSUUsUUFBQSxJQUFBLEdBQU8sTUFBTSxDQUFDLGtCQUFQLENBQUEsQ0FBUCxDQUpGO09BWEE7YUFpQkEsTUFBTSxDQUFDLE1BQVAsQ0FBYyxJQUFkLEVBQW9CLFNBQXBCLEVBbEJRO0lBQUEsQ0FSVjtBQUFBLElBNEJBLFdBQUEsRUFBYSxTQUFBLEdBQUE7YUFDWCxNQUFNLENBQUMsTUFBUCxDQUFjLElBQUksQ0FBQyxTQUFTLENBQUMsZUFBZixDQUFBLENBQWdDLENBQUMsa0JBQWpDLENBQUEsQ0FBZCxFQUFxRSxJQUFyRSxFQURXO0lBQUEsQ0E1QmI7QUFBQSxJQStCQSxNQUFBLEVBQVEsU0FBQyxNQUFELEVBQVMsU0FBVCxHQUFBO0FBQ04sVUFBQSxRQUFBO0FBQUEsTUFBQSxJQUFHLFNBQUg7QUFDRSxRQUFBLFFBQUEsR0FBVyxJQUFJLENBQUMsU0FBUyxDQUFDLGVBQWYsQ0FBQSxDQUFnQyxDQUFDLFVBQWpDLENBQUEsQ0FBNkMsQ0FBQyxJQUF6RCxDQURGO09BQUE7YUFHQSxLQUFBLENBQU0sTUFBTixFQUFjLENBQUMsSUFBQyxDQUFBLFVBQUQsQ0FBWSxNQUFaLEVBQW9CLFFBQXBCLENBQUQsQ0FBZCxFQUpNO0lBQUEsQ0EvQlI7QUFBQSxJQXFDQSxVQUFBLEVBQVksU0FBQyxNQUFELEVBQVMsUUFBVCxHQUFBO0FBQ1YsVUFBQSxVQUFBO0FBQUEsTUFBQSxJQUF1RCxRQUF2RDtBQUFBLFFBQUEsSUFBQSxHQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBWixDQUFnQixnQkFBQSxHQUFtQixRQUFuQyxDQUFQLENBQUE7T0FBQTtBQUFBLE1BQ0EsSUFBQSxHQUFPLGdCQURQLENBQUE7QUFHQSxNQUFBLG1CQUFHLElBQUksQ0FBRSxlQUFUO0FBQ0UsUUFBQSxJQUFBLElBQVEsT0FBQSxHQUFVLElBQUksQ0FBQyxHQUFMLENBQVMsa0JBQVQsQ0FBNEIsQ0FBQyxJQUE3QixDQUFrQyxHQUFsQyxDQUFWLEdBQW1ELEdBQTNELENBREY7T0FIQTthQU1BLElBQUEsR0FBTyxRQUFQLEdBQWtCLGtCQUFBLENBQW1CLE1BQW5CLEVBUFI7SUFBQSxDQXJDWjtHQUpGLENBQUE7QUFBQSIKfQ==
//# sourceURL=/Users/taichi.nakashima/.dotfiles/atom/packages/dash/lib/dash.coffee